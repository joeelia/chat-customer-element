const b = '*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before,:after{--tw-content: ""}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.fixed{position:fixed}.bottom-0{bottom:0}.right-0{right:0}.mb-2{margin-bottom:.5rem}.mb-4{margin-bottom:1rem}.ml-1{margin-left:.25rem}.mr-4{margin-right:1rem}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.h-16{height:4rem}.h-4{height:1rem}.h-6{height:1.5rem}.h-8{height:2rem}.h-\\[400px\\]{height:400px}.w-16{width:4rem}.w-2{width:.5rem}.w-6{width:1.5rem}.w-8{width:2rem}.w-96{width:24rem}.flex-1{flex:1 1 0%}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(.4,0,.6,1) infinite}@keyframes spin{to{transform:rotate(360deg)}}.animate-spin{animation:spin 1s linear infinite}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:.5rem}.overflow-y-auto{overflow-y:auto}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-md{border-radius:.375rem}.rounded-t-lg{border-top-left-radius:.5rem;border-top-right-radius:.5rem}.border{border-width:1px}.border-b{border-bottom-width:1px}.border-gray-200{--tw-border-opacity: 1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1))}.bg-black{--tw-bg-opacity: 1;background-color:rgb(0 0 0 / var(--tw-bg-opacity, 1))}.bg-blue-50{--tw-bg-opacity: 1;background-color:rgb(239 246 255 / var(--tw-bg-opacity, 1))}.bg-gray-300{--tw-bg-opacity: 1;background-color:rgb(209 213 219 / var(--tw-bg-opacity, 1))}.bg-gray-50{--tw-bg-opacity: 1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.bg-green-50{--tw-bg-opacity: 1;background-color:rgb(240 253 244 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-yellow-50{--tw-bg-opacity: 1;background-color:rgb(254 252 232 / var(--tw-bg-opacity, 1))}.p-2{padding:.5rem}.p-4{padding:1rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-bold{font-weight:700}.text-white{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.shadow{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-2xl{--tw-shadow: 0 25px 50px -12px rgb(0 0 0 / .25);--tw-shadow-colored: 0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1);--tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.outline-none{outline:2px solid transparent;outline-offset:2px}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.hover\\:opacity-80:hover{opacity:.8}.focus\\:ring-2:focus{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}';
(function() {
  class u extends HTMLElement {
    constructor() {
      super(), this.messages = [], this.attachShadow({ mode: "open" }), this.teamId = null, this.config = {
        title: "Chat Box",
        position: "bottom-right",
        hexCode: "#3B82F6"
        // Default blue color
      }, this.isOpen = !1, this.isLoading = !0, this.currentStreamingMessage = null;
      const t = new CSSStyleSheet();
      t.replaceSync(b), this.shadowRoot.adoptedStyleSheets = [t];
    }
    async connectedCallback() {
      if (this.teamId = this.getAttribute("team-id") || window.AI_CHAT_TEAM_ID || window.CHAT_TEAM_ID, !this.teamId) {
        console.error("Chat component requires a team ID (set window.AI_CHAT_TEAM_ID)");
        return;
      }
      switch (this.style.position = "fixed", this.style.zIndex = "9999", await this.fetchConfig(), this.config.position) {
        case "bottom-left":
          this.style.bottom = "20px", this.style.left = "20px";
          break;
        case "top-right":
          this.style.top = "20px", this.style.right = "20px";
          break;
        case "top-left":
          this.style.top = "20px", this.style.left = "20px";
          break;
        default:
          this.style.bottom = "20px", this.style.right = "20px";
      }
      this.messages.push("Assistant: Hello! I'm your legal assistant with access to this firm's information. How can I help you today?"), this.render(), this.messages.length === 0 ? this.fetchInitialMessages() : this.isLoading = !1;
    }
    async fetchConfig() {
      try {
        const t = await fetch(`https://v3.notthebestagency.com/api/teams/${this.teamId}/business-details?chatbot`, {
          credentials: "omit",
          // Don't send credentials for cross-origin requests
          mode: "cors"
          // Explicitly set CORS mode
        });
        if (!t.ok)
          throw new Error(`Failed to fetch config: ${t.status}`);
        const e = await t.json();
        e.chatbot && (this.config = {
          title: e.chatbot.title || "Chat Box",
          position: e.chatbot.position || "bottom-right",
          hexCode: e.chatbot.hexCode || "#3B82F6"
        }), this.isLoading = !1;
      } catch (t) {
        console.error("Error fetching chat configuration:", t), this.isLoading = !1;
      }
    }
    async fetchInitialMessages() {
      try {
        const t = await fetch(`https://v3.notthebestagency.com/api/chatbot/${this.teamId}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          credentials: "omit",
          // Don't send credentials for cross-origin requests
          mode: "cors",
          // Explicitly set CORS mode
          body: JSON.stringify({
            messages: []
          })
        });
        if (!t.ok)
          throw new Error(`Failed to fetch messages: ${t.status}`);
        this.currentStreamingMessage = "Assistant: ", this.messages.push(this.currentStreamingMessage), this.renderMessages();
        const e = t.body.getReader(), o = new TextDecoder(), s = this.messages.indexOf(this.currentStreamingMessage);
        for (; ; ) {
          const { done: r, value: i } = await e.read();
          if (r)
            break;
          const d = o.decode(i, { stream: !0 }).split(`
`);
          for (const c of d)
            if (c.trim().startsWith("data:"))
              try {
                const a = c.trim().substring(5).trim();
                if (a === "[DONE]") continue;
                const h = JSON.parse(a);
                h.response !== void 0 && (this.currentStreamingMessage += h.response, s !== -1 && (this.messages[s] = this.currentStreamingMessage, this.renderMessages()));
              } catch (a) {
                console.warn("Error parsing streaming data:", a);
              }
        }
        this.currentStreamingMessage = null;
      } catch (t) {
        if (console.error("Error fetching initial messages:", t), this.currentStreamingMessage) {
          const e = this.messages.indexOf(this.currentStreamingMessage);
          e !== -1 && this.messages.splice(e, 1), this.currentStreamingMessage = null;
        }
        this.messages.push("System: Unable to load initial messages"), this.renderMessages();
      }
    }
    toggleChat() {
      this.isOpen = !this.isOpen, this.render();
    }
    async sendMessage(t) {
      try {
        this.messages.push(`You: ${t}`), this.renderMessages();
        const e = this.prepareMessagesForAPI(t);
        this.currentStreamingMessage = "Assistant: ", this.messages.push(this.currentStreamingMessage), this.renderMessages();
        const o = `https://v3.notthebestagency.com/api/chatbot/${this.teamId}`, s = await fetch(o, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          credentials: "omit",
          // Don't send credentials for cross-origin requests
          mode: "cors",
          // Explicitly set CORS mode
          body: JSON.stringify({
            messages: e
          })
        });
        if (!s.ok)
          throw new Error(`Failed to send message: ${s.status}`);
        const r = s.body.getReader(), i = new TextDecoder(), n = this.messages.indexOf(this.currentStreamingMessage);
        for (; ; ) {
          const { done: d, value: c } = await r.read();
          if (d)
            break;
          const h = i.decode(c, { stream: !0 }).split(`
`);
          for (const p of h)
            if (p.trim().startsWith("data:"))
              try {
                const l = p.trim().substring(5).trim();
                if (l === "[DONE]") continue;
                const w = JSON.parse(l);
                w.response !== void 0 && (this.currentStreamingMessage += w.response, n !== -1 && (this.messages[n] = this.currentStreamingMessage, this.renderMessages()));
              } catch (l) {
                console.warn("Error parsing streaming data:", l);
              }
        }
        this.currentStreamingMessage = null;
      } catch (e) {
        if (console.error("Error sending message:", e), this.currentStreamingMessage) {
          const o = this.messages.indexOf(this.currentStreamingMessage);
          o !== -1 && this.messages.splice(o, 1), this.currentStreamingMessage = null;
        }
        this.messages.push("System: Error sending message"), this.renderMessages();
      }
    }
    prepareMessagesForAPI(t) {
      const e = [];
      for (const s of this.messages)
        s.startsWith("You: ") ? e.push({
          role: "user",
          content: s.substring(5)
        }) : s.startsWith("Assistant: ") && e.push({
          role: "assistant",
          content: s.substring(11)
        });
      const o = e[e.length - 1];
      return (!o || o.role !== "user" || o.content !== t) && e.push({
        role: "user",
        content: t
      }), e;
    }
    hexToRgb(t) {
      t = t.replace(/^#/, "");
      const e = parseInt(t, 16), o = e >> 16 & 255, s = e >> 8 & 255, r = e & 255;
      return { r: o, g: s, b: r };
    }
    generateColorClasses(t) {
      const e = this.hexToRgb(t), o = document.createElement("style");
      return o.textContent = `
        :host {
          --primary-color: ${t};
          --primary-hover: ${this.adjustBrightness(t, -10)};
          --primary-text: ${this.getContrastColor(e)};
        }
      `, o;
    }
    adjustBrightness(t, e) {
      t = t.replace(/^#/, "");
      let o = parseInt(t.substring(0, 2), 16), s = parseInt(t.substring(2, 4), 16), r = parseInt(t.substring(4, 6), 16);
      return o = Math.max(0, Math.min(255, o + e)), s = Math.max(0, Math.min(255, s + e)), r = Math.max(0, Math.min(255, r + e)), `#${((1 << 24) + (o << 16) + (s << 8) + r).toString(16).slice(1)}`;
    }
    getContrastColor({ r: t, g: e, b: o }) {
      return (0.299 * t + 0.587 * e + 0.114 * o) / 255 > 0.5 ? "#000000" : "#FFFFFF";
    }
    render() {
      if (this.isLoading) {
        this.shadowRoot.innerHTML = `
          <button 
            class="w-16 h-16 rounded-full bg-gray-300 text-white flex items-center justify-center shadow-lg"
            aria-label="Loading chat"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 animate-spin" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
          </button>
        `;
        return;
      }
      const t = this.generateColorClasses(this.config.hexCode);
      this.shadowRoot.appendChild(t), this.isOpen ? (this.shadowRoot.innerHTML = `
          <div class="fixed bottom-0 right-0 mb-4 mr-4 w-96 rounded-lg bg-white shadow-2xl transition-all">
            <div class="flex items-center justify-between p-4 rounded-t-lg" 
                 style="background-color: ${this.config.hexCode}; color: ${this.getContrastColor(this.hexToRgb(this.config.hexCode))};">
              <h2 class="text-xl font-bold">${this.config.title}</h2>
              <button 
                class="hover:opacity-80 transition-opacity"
                aria-label="Close chat"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
            <div id="messages" class="h-[400px] overflow-y-auto p-4 border-b border-gray-200"></div>
            <form id="messageForm" class="p-4 flex gap-2">
              <input 
                type="text" 
                id="messageInput"
                class="flex-1 px-3 py-2 border border-gray-200 rounded-md outline-none focus:ring-2"
                style="focus-border-color: ${this.config.hexCode}; focus-ring-color: ${this.config.hexCode};"
                placeholder="Type your message..."
              />
              <button type="submit" class="px-4 py-2 rounded-md transition-colors"
                      style="background-color: ${this.config.hexCode}; color: ${this.getContrastColor(this.hexToRgb(this.config.hexCode))};">
                Send
              </button>
            </form>
          </div>
        `, this.shadowRoot.querySelector("button").addEventListener("click", () => this.toggleChat()), this.shadowRoot.querySelector("#messageForm").addEventListener("submit", (o) => {
        o.preventDefault();
        const s = this.shadowRoot.querySelector("#messageInput"), r = s.value.trim();
        r && (this.sendMessage(r), s.value = "");
      }), this.renderMessages()) : (this.shadowRoot.innerHTML = `
          <button 
            class="w-16 h-16 rounded-full flex items-center justify-center transition-colors shadow-lg"
            style="background-color: ${this.config.hexCode}; color: ${this.getContrastColor(this.hexToRgb(this.config.hexCode))};"
            aria-label="Open chat"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
            </svg>
          </button>
        `, this.shadowRoot.querySelector("button").addEventListener("click", () => this.toggleChat()));
    }
    renderMessages() {
      const t = this.shadowRoot.querySelector("#messages");
      t && (t.innerHTML = this.messages.map((e) => {
        const o = e.startsWith("Assistant:"), s = e.startsWith("System:"), r = e.startsWith("You:");
        let i = "bg-gray-50";
        o ? i = "bg-blue-50" : s ? i = "bg-yellow-50" : r && (i = "bg-green-50");
        let n = e;
        return this.currentStreamingMessage === e && (n += '<span class="inline-block w-2 h-4 bg-black ml-1 animate-pulse"></span>'), `<div class="p-2 mb-2 ${i} rounded-md">${n}</div>`;
      }).join(""), t.scrollTop = t.scrollHeight);
    }
  }
  if (!customElements.get("chat-box") && (customElements.define("chat-box", u), !document.querySelector("chat-box"))) {
    const g = document.createElement("chat-box");
    document.body.appendChild(g);
  }
})();
